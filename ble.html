<!DOCTYPE html><!-- This site was created in Webflow. https://webflow.com --><!-- Last Published: Mon Sep 16 2024 02:55:40 GMT+0000 (Coordinated Universal Time) -->
<html data-wf-domain="mugicmotion.webflow.io" data-wf-page="66e47ac0896a027e8506c008" data-wf-site="66521f39ad9f5f9fd9e981de" lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>BLE</title>
        <meta content="BLE" property="og:title"/>
        <meta content="BLE" property="twitter:title"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <meta content="Webflow" name="generator"/>
        <meta content="noindex" name="robots"/>
        <link href="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/css/mugicmotion.webflow.ba24b9f8e.min.css" rel="stylesheet" type="text/css"/>
        <link href="https://fonts.googleapis.com" rel="preconnect"/>
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous"/>
        <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Baskervville:regular,italic","Poppins:100,100italic,200,200italic,300,300italic,regular,italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]  }});</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
        <link href="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/665960e127c4f197141def3b_mugic-Favicon-black.svg" rel="shortcut icon" type="image/x-icon"/>
        <link href="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/665960f304575e7ce9912cb8_mugic-webclip%20-%20black.jpg" rel="apple-touch-icon"/>
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6NBZNRBVBL"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZGVlNj', true);gtag('config', 'G-6NBZNRBVBL');</script>
        <script src="https://cdn.jsdelivr.net/npm/protobufjs/dist/protobuf.min.js"></script>
    </head>
    <body>
        <div class="main-wrapper">
            <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav">
                <nav class="navigation-wrap">
                    <a href="/" class="logo-link w-nav-brand"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652ba707d431aabc44a4afa_mugic-logo.png" width="200" alt="mugic motion logo. black mu symbol in an orange circle with he words mugicmotion next to it - light version" class="logo-image"/></a>
                    <div class="menu">
                        <nav role="navigation" class="navigation-items w-nav-menu">
                            <a href="/about" class="navigation-item w-nav-link">About</a>
                            <div data-hover="false" data-delay="0" class="w-dropdown">
                                <nav class="dropdown-toggle-2 w-dropdown-toggle">
                                    <div class="w-icon-dropdown-toggle"></div>
                                    <div>Support</div>
                                </nav>
                                <nav class="nav_dropdown w-dropdown-list"><a href="/support/home" class="nav_dropdown-link first w-dropdown-link">General</a><a href="/support/getting-started" class="nav_dropdown-link w-dropdown-link">Getting Started</a><a href="/support/connect-multiple-mugics" class="nav_dropdown-link middle w-dropdown-link">Connecting Multiple Mugics</a></nav>
                            </div>
                            <a href="/community" class="navigation-item w-nav-link">Community</a><a href="/contact" class="navigation-item w-nav-link">Contact</a>
                        </nav>
                        <div class="menu-button w-nav-button"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/66521f39ad9f5f9fd9e98266_menu-icon.png" width="22" alt="" class="menu-icon"/></div>
                    </div>
                </nav>
            </div>
            <div class="section_about">
                <div class="padding-global">
                    <div class="container-medium">
                        <div class="padding-section-large">
                            <div class="ble_content">
                                <div class="text-content_component">
                                    <h1 class="heading-style-h3">Bluetooth Config</h1>
                                    <div class="ble_text-content">
                                        <p class="max-width-medium">To change MUGIC® parameters, such as:</p>
                                        <ul role="list">
                                            <li>AP Mode: network name (AP SSID) and password, and port number,</li>
                                            <li>Client Mode: network name (WiFi SSID) and password, and port number, as well as Client IPs to send the MUGIC® data to,</li>
                                            <li>Bluetooth: device name (BLE Name),</li>
                                            <li>Other parameters: output data format, frequency, etc.</li>
                                        </ul>
                                    </div>
                                    <div class="ble_text-content">
                                        <p class="max-width-medium">Editing configuration can be done in a browser such as Chrome</p>
                                        <ul role="list">
                                            <li>via Wi-Fi:<br/>- When connected to MUGIC® in AP mode, simply visit http://192.168.4.1/configure<br/>-  In Wi-Fi Client mode, use the IP address of MUGIC® instead of 192.168.4.1<br/></li>
                                            <li>via Bluetooth:<br/>- Visit https://mugicmotion.com/mugic2/ble-config using Google Chrome (will not work on Safari).<br/>- Click on “Connect to Mugic Device”, a popup window will open.<br/>- Press Power and Mode buttons simultaneously, the BLE name of your mugic should appear in the window, select it and click “Pair”.</li>
                                        </ul>
                                    </div>
                                    <div class="ble_text-content">
                                        <p class="max-width-medium">In either of these websites:</p>
                                        <ul role="list">
                                            <li>Edit the existing value(s), then press ”Send”.</li>
                                            <li>A &quot;Configuration accepted&quot; popup will confirm the change.</li>
                                            <li>An &quot;Error&quot; popup with an explanation will indicate that the change was not applied to MUGIC®.</li>
                                        </ul>
                                    </div>
                                </div>
                                <h1 id="w-node-_4212c86f-5976-7aa4-6191-40be271fe46a-8506c008" class="heading-style-h3">Bluetooth Configurator</h1>

    <button id="connectBtn">Connect to Mugic Device</button>

    <div id="commandDiv" style="display: none;">
        <h2>Send Commands</h2>

        <!-- Set Output Mode -->
        <!-- <h3>Set Output Mode</h3>
        <select id="outputMode">
            <option value="0">SERIAL_MODE</option>
            <option value="1">WIFI_AP_MODE</option>
            <option value="2">WIFI_CLIENT_MODE</option>
            <option value="3">BLE_MODE</option>
            <option value="-1">UNSPECIFIED_MODE</option>
        </select>
        <button onclick="sendSetOutputMode()">Send</button><br><br> -->

        <!-- Configure WiFi AP -->
        <h3>Configure WiFi AP</h3>
        <input type="text" id="wifiApSsid" placeholder="AP SSID">
        <input type="text" id="wifiApPassword" placeholder="AP Password">
        <input type="number" id="wifiApPort" placeholder="Port">
        <button onclick="sendConfigureWifiAp()">Send</button><br><br>

        <!-- Configure WiFi Client -->
        <h3>Configure WiFi Client</h3>
        <input type="text" id="wifiClientSsid" placeholder="Wifi SSID">
        <input type="text" id="wifiClientPassword" placeholder="Wifi Password">
        <input type="number" id="wifiClientPort" placeholder="Port">
        <button onclick="sendConfigureWifiClient()">Send</button><br><br>

        <!-- Configure BLE -->
        <h3>Configure BLE</h3>
        <input type="text" id="bleName" placeholder="BLE Name">
        <button onclick="sendConfigureBle()">Send</button><br><br>

        <!-- Get Diagnostics -->
        <!-- <h3>Get Diagnostics</h3>
        <button onclick="sendGetDiagnostics()">Send</button><br><br> -->

        <!-- Get Configuration -->
        <h3>Get Assigned IP</h3>
        <input type="text" id="assignedIp" placeholder="No Assigned IP" readonly>
        <button onclick="sendGetAssignedIP()">Check IP</button><br><br>

        <!-- Configure Client IP -->
        <h3>Configure Client IP</h3>
        <input type="text" id="clientIp0" placeholder="IP 0">
        <input type="text" id="clientIp1" placeholder="IP 1">
        <input type="text" id="clientIp2" placeholder="IP 2">
        <input type="text" id="clientIp3" placeholder="IP 3">
        <input type="text" id="clientIp4" placeholder="IP 4">
        <input type="text" id="clientIp5" placeholder="IP 5">
        <input type="text" id="clientIp6" placeholder="IP 6">
        <input type="text" id="clientIp7" placeholder="IP 7">
        <button onclick="sendConfigureClientIp()">Send</button><br><br>

        <!-- Set Output Frequency -->
        <h3>Set Output Frequency</h3>
        <input type="number" id="outputFrequency" placeholder="Frequency (ms)">
        <button onclick="sendSetOutputFrequency()">Send</button><br><br>

        <!-- Set Output Data Format -->
        <h3>Set Output Data Format</h3>
        <select id="outputDataFormat">
            <option value="0">OSC</option>
            <option value="1">JSON</option>
            <option value="3">ASCII</option>
        </select>
        <button onclick="sendSetOutputDataFormat()">Send</button><br><br>

    </div>

    <script>
        let bleDevice;
        let bleServer;
        let bleService;
        let bleCharacteristic;

        // Load the protobuf definition
        protobuf.load("config_api.proto", function(err, root) {
            if (err) {
                console.error(err);
                return;
            }

            window.ConfigTaskCommand = root.lookupType("ConfigTaskCommand");
            window.ConfigTaskResponse = root.lookupType("ConfigTaskResponse");
            window.TaskState = root.lookupType("ConfigTaskResponse");

        });

        document.getElementById("connectBtn").addEventListener("click", async function() {
            try {
                const serviceUuid = 0x5501;
                const characteristicUuid = 0x113a;
                
                if (!navigator.bluetooth) {
                    alert('Your browser does not support Web Bluetooth!');
                    return;
                }

                bleDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'mu' }],
                    optionalServices: [serviceUuid] 
                });



                gattServer = await bleDevice.gatt.connect();
                service = await gattServer.getPrimaryService(serviceUuid); 
                characteristic = await service.getCharacteristic(characteristicUuid);

                // Start notifications
                await characteristic.startNotifications();
                characteristic.addEventListener('characteristicvaluechanged', handleNotifications);

                document.getElementById("commandDiv").style.display = "block";
                //get configuration to prepopulate boxes
                const command = ConfigTaskCommand.create({
                    getConfiguration: {} 
                });
                const buffer = ConfigTaskCommand.encode(command).finish();
                try {
                await characteristic.writeValue(buffer);
                console.log("Command sent:", command);
                } catch (error) {
                    console.error("Failed to send command", error);
                }

            } catch (error) {
                console.error("Connection failed", error);
            }
        });

        async function sendCommand(command) {
            const buffer = ConfigTaskCommand.encode(command).finish();
            try {
                await characteristic.writeValue(buffer);
                console.log("Command sent:", command);
            } catch (error) {
                console.error("Failed to send command", error);
            }
        }

        function sendSetOutputDataFormat() {
            const outputDataFormat = parseInt(document.getElementById('outputDataFormat').value);
            const command = ConfigTaskCommand.create({
                    setOutputDataFormat: { outputDataFormat: outputDataFormat }
            });
            sendCommand(command);
        }

        function sendSetOutputFrequency() {
            const frequency = parseInt(document.getElementById('outputFrequency').value);
            const command = ConfigTaskCommand.create({
                setOutputFrequency: { frequency: frequency } 
            });
            sendCommand(command);
        }

        // function sendSetOutputMode() {
        //     const outputDataMode = parseInt(document.getElementById('outputMode').value);
        //     const command = ConfigTaskCommand.create({
        //         command: {
        //             set_output_mode: SetOutputMode.create({ output_data_mode: outputDataMode })
        //         }
        //     });
        //     sendCommand(command);
        // }

        function sendConfigureWifiAp() {
            const ssid = document.getElementById('wifiApSsid').value;
            const password = document.getElementById('wifiApPassword').value;
            const port = parseInt(document.getElementById('wifiApPort').value);
            const command = ConfigTaskCommand.create({
                configureWifiAp: { ssid: ssid, password: password, port: port }
            });
            sendCommand(command);
        }

        function sendConfigureWifiClient() {
            const ssid = document.getElementById('wifiClientSsid').value;
            const password = document.getElementById('wifiClientPassword').value;
            const port = parseInt(document.getElementById('wifiClientPort').value);
            const command = ConfigTaskCommand.create({
                configureWifiClient: { ssid: ssid, password: password, port: port }
            });
            sendCommand(command);
        }

        function sendConfigureBle() {
            const bleName = document.getElementById('bleName').value;
            const command = ConfigTaskCommand.create({
                configureBle: { bleName: bleName }
            });
            sendCommand(command);
        }

        function sendConfigureClientIp() {
            const ip0 = document.getElementById('clientIp0').value;
            const ip1 = document.getElementById('clientIp1').value;
            const ip2 = document.getElementById('clientIp2').value;
            const ip3 = document.getElementById('clientIp3').value;
            const ip4 = document.getElementById('clientIp4').value;
            const ip5 = document.getElementById('clientIp5').value;
            const ip6 = document.getElementById('clientIp6').value;
            const ip7 = document.getElementById('clientIp7').value;
            const command = ConfigTaskCommand.create({
                    configureClientIp: { ip0: ip0, ip1: ip1, ip2: ip2, ip3: ip3, ip4: ip4, ip5: ip5, ip6: ip6, ip7: ip7 }
            });
            sendCommand(command);
        }

        // function sendGetDiagnostics() {
        //     const command = ConfigTaskCommand.create({
        //         command: { get_diagnostics: {} }
        //     });
        //     sendCommand(command);
        // }

        // function sendGetConfiguration() {
        //     const command = ConfigTaskCommand.create({
        //         command: { get_configuration: {} }
        //     });
        //     sendCommand(command);
        // }

        function sendGetAssignedIP() {
            const command = ConfigTaskCommand.create({
                getAssignedIp: {} 
            });
            sendCommand(command);
        }

        // Handle BLE notification
        async function handleNotifications(event) {
            const value = event.target.value;
            const buffer = new Uint8Array(value.buffer);

            // Decode the Protobuf response
            const decodedResponse = ConfigTaskResponse.decode(buffer);
            console.log("Received response:", decodedResponse);

            // Show a popup based on the response type
            displayPopup(decodedResponse);
        }

         // Function to display a popup based on the ConfigTaskResponse
         function displayPopup(response) {
            let taskState;

                // Check for the various responses and extract TaskState
                if (response.setOutputFrequencyResponse) {
                    taskState = response.setOutputFrequencyResponse.taskState;
                } else if (response.configureWifiApResponse) {
                    taskState = response.configureWifiApResponse.taskState;
                }  else if (response.configureWifiClientResponse) {
                    taskState = response.configureWifiClientResponse.taskState;    
                } else if (response.configureClientIpResponse) {
                    taskState = response.configureClientIpResponse.taskState;
                } else if (response.configureBleResponse) {
                    taskState = response.configureBleResponse.taskState;
                } else if (response.setOutputDataFormatResponse) {
                    taskState = response.getAssignedIpResponse.taskState;
                } else if (response.getAssignedIpResponse) {
                    if(response.getAssignedIpResponse.ip === undefined || response.getAssignedIpResponse.ip.trim() === ''){
                        return;
                    }
                    document.getElementById('assignedIp').value = response.getAssignedIpResponse.ip;
                    return;
                } else if (response.getConfigurationResponse) {
                    document.getElementById('outputFrequency').value = response.getConfigurationResponse.frequency;
                    document.getElementById('clientIp7').value = response.getConfigurationResponse.ip7;

                    document.getElementById('wifiApSsid').value = response.getConfigurationResponse.apSsid;
                    document.getElementById('wifiApPassword').value = response.getConfigurationResponse.apPassword;
                    document.getElementById('wifiApPort').value = response.getConfigurationResponse.apPort;
                    
                    document.getElementById('wifiClientSsid').value = response.getConfigurationResponse.staSsid;
                    document.getElementById('wifiClientPassword').value = response.getConfigurationResponse.staPassword;
                    document.getElementById('wifiClientPort').value = response.getConfigurationResponse.staPort;
                    
                    document.getElementById('clientIp0').value = response.getConfigurationResponse.ip0;
                    document.getElementById('clientIp1').value = response.getConfigurationResponse.ip1;
                    document.getElementById('clientIp2').value = response.getConfigurationResponse.ip2;
                    document.getElementById('clientIp3').value = response.getConfigurationResponse.ip3;
                    document.getElementById('clientIp4').value = response.getConfigurationResponse.ip4;
                    document.getElementById('clientIp5').value = response.getConfigurationResponse.ip5;
                    document.getElementById('clientIp6').value = response.getConfigurationResponse.ip6;
                    document.getElementById('clientIp7').value = response.getConfigurationResponse.ip7;

                    document.getElementById('outputDataFormat').value = response.getConfigurationResponse.outputDataFormat;
                    document.getElementById('bleName').value = response.getConfigurationResponse.bleName;
                    return;
                }

            // Check the task state and display appropriate message
            if (taskState === 0) { // Assuming 0 is TASK_SUCCESS
                alert("Configuration Accepted!");
            } else {
                alert("Error!");
            }
        }
    </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <section class="footer-dark">
                <div class="footer-wrapper">
                    <a href="#" class="nav_logo-2 w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652c18a7a4d9fdef6a765c9_mugic-logo_white.png" loading="lazy" width="228" height="Auto" alt="mugic motion logo. black mu symbol in an orange circle with he words mugicmotion next to it - dark version" class="logo-image"/></a>
                    <div class="footer-content">
                        <div id="w-node-_024b803f-e7d9-aea5-8c36-9028b4f64985-b4f64980" class="footer-block"><a href="/" class="footer-link">Home</a></div>
                        <div id="w-node-_75355bb7-880d-4172-3bbf-bbcf8a111e0e-b4f64980" class="footer-block"><a href="/support/home" class="footer-link">Support</a></div>
                        <div id="w-node-_024b803f-e7d9-aea5-8c36-9028b4f6498a-b4f64980" class="footer-block"><a href="/community" class="footer-link">Community</a></div>
                        <div id="w-node-b11dd981-4111-1331-1fae-e5e5917ef09e-b4f64980" class="footer-block"><a href="/about" class="footer-link">About</a></div>
                        <div id="w-node-_024b803f-e7d9-aea5-8c36-9028b4f6498f-b4f64980" class="footer-block"><a href="/contact" class="footer-link">Contact</a></div>
                    </div>
                </div>
                <div class="footer-divider"></div>
                <div class="footer-extras">
                    <div class="footer-copyright">Copyright © 2024  Kimari, LLC - All Rights Reserved. Website Design by <a href="https://mykalle-bonnevie-portfolio.webflow.io/" class="inline-link-white">Mykalle Bonnevie</a></div>
                    <div class="footer-socials"><a href="mailto:marikimura@mugicmotion.com?subject=Mugic%20Motion" class="contact_email w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652bbf48b360cc1f359213a_email-icon.svg" loading="lazy" alt="mail icon - white" class="contact-icons"/></a><a href="https://www.facebook.com/mugicmotion/" target="_blank" class="contact_facebook w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652bbf38b360cc1f35920f3_Vectors-Wrapper.svg" loading="lazy" alt="Facebook Logo White" class="contact-icons"/></a><a href="https://www.instagram.com/mugicmotion/" target="_blank" class="contact_instagram w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652bbf48b360cc1f3592109_Vectors-Wrapper.svg" loading="lazy" alt="Instagram Logo White" class="contact-icons"/></a><a href="https://www.youtube.com/channel/UCWsIBAjaagKaSP1qjCvgeLw" target="_blank" class="contact_youtube w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6652bbf48b360cc1f3592125_Vectors-Wrapper.svg" loading="lazy" alt="Youtube Logo White" class="contact-icons"/></a><a href="https://discord.gg/2Fg8p7fDpe" target="_blank" class="contact_discord w-inline-block"><img src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/6694208a3dc19067ead14137_discord-icon.svg" loading="lazy" alt=""/></a></div>
                </div>
            </section>
        </div>
        <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66521f39ad9f5f9fd9e981de" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://cdn.prod.website-files.com/66521f39ad9f5f9fd9e981de/js/webflow.b6f82a8f8.js" type="text/javascript"></script>
    </body>
</html>
